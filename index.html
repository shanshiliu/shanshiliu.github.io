<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ§§ çº¢åŒ…æŠ½å¥–</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script>
    // å…¨å±€ Tailwind é…ç½®
    tailwind.config = {
      content: [document.body],
    }
  </script>

  <script>
    const { useState, useEffect } = React;

    // çº¢åŒ…æŠ½å¥–åº”ç”¨
    const LuckyDrawApp = () => {
      const [currentPage, setCurrentPage] = useState('loading');
      const [config, setConfig] = useState(null);
      const [redPackets, setRedPackets] = useState([]);
      const [openedPackets, setOpenedPackets] = useState(new Set());
      const [currentRound, setCurrentRound] = useState(1);
      const [showResult, setShowResult] = useState(null);
      const [animating, setAnimating] = useState(false);
      const [showResetModal, setShowResetModal] = useState(false);
      const [showReconfigModal, setShowReconfigModal] = useState(false);

      // åˆå§‹åŒ–ï¼šæ£€æŸ¥æ˜¯å¦æœ‰é…ç½®
      useEffect(() => {
        const loadConfig = async () => {
          try {
            const result = localStorage.getItem('lottery_config');
            if (result) {
              const savedConfig = JSON.parse(result);
              setConfig(savedConfig);

              // åŠ è½½å½“å‰è½®æ¬¡å’Œå·²å¼€çº¢åŒ…
              const roundResult = localStorage.getItem('current_round');
              const openedResult = localStorage.getItem('opened_packets');

              if (roundResult) {
                setCurrentRound(parseInt(roundResult));
              }

              if (openedResult) {
                setOpenedPackets(new Set(JSON.parse(openedResult)));
              }

              setCurrentPage('draw');
            } else {
              setCurrentPage('setup');
            }
          } catch (error) {
            setCurrentPage('setup');
          }
        };

        loadConfig();
      }, []);

      // ç”Ÿæˆçº¢åŒ…æ•°æ®
      useEffect(() => {
        if (config && currentPage === 'draw') {
          generateRedPackets();
        }
      }, [config, currentRound, currentPage]);

      const generateRedPackets = () => {
        if (!config) return;

        const packets = [];
        const prizePool = [];

        // åˆ›å»ºå¥–é¡¹æ± 
        config.prizes.forEach(prize => {
          for (let i = 0; i < prize.count; i++) {
            prizePool.push({
              name: prize.name,
              color: prize.color
            });
          }
        });

        // æ·»åŠ æœªä¸­å¥–çº¢åŒ…
        const emptyCount = config.totalPackets - prizePool.length;
        for (let i = 0; i < emptyCount; i++) {
          prizePool.push(null);
        }

        // æ´—ç‰Œç®—æ³• - Fisher-Yates
        for (let i = prizePool.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [prizePool[i], prizePool[j]] = [prizePool[j], prizePool[i]];
        }

        // ç”Ÿæˆçº¢åŒ…ç½‘æ ¼ä½ç½® - å®Œå…¨æ— é‡å çš„ç½‘æ ¼å¸ƒå±€
        const cols = Math.ceil(Math.sqrt(config.totalPackets * 1.2));
        const rows = Math.ceil(config.totalPackets / cols);

        prizePool.forEach((prize, index) => {
          const row = Math.floor(index / cols);
          const col = index % cols;

          packets.push({
            id: index,
            prize: prize,
            row: row,
            col: col
          });
        });

        setRedPackets(packets);
      };

      const handleSetupSubmit = async (setupData) => {
        try {
          localStorage.setItem('lottery_config', JSON.stringify(setupData));
          localStorage.setItem('current_round', '1');
          localStorage.setItem('opened_packets', JSON.stringify([]));

          setConfig(setupData);
          setCurrentRound(1);
          setOpenedPackets(new Set());
          setCurrentPage('draw');
          setShowReconfigModal(false);
        } catch (error) {
          alert('ä¿å­˜é…ç½®å¤±è´¥ï¼Œè¯·é‡è¯•');
        }
      };

      const handlePacketClick = async (packet) => {
        if (openedPackets.has(packet.id) || animating) return;

        setAnimating(true);
        const newOpened = new Set(openedPackets);
        newOpened.add(packet.id);
        setOpenedPackets(newOpened);

        try {
          localStorage.setItem('opened_packets', JSON.stringify([...newOpened]));
        } catch (error) {
          console.error('ä¿å­˜å¤±è´¥');
        }

        setTimeout(() => {
          setShowResult(packet.prize);
          setAnimating(false);
        }, 500);
      };

      const handleNextRound = async () => {
        if (currentRound >= config.totalRounds) return;

        const nextRound = currentRound + 1;
        setCurrentRound(nextRound);
        setOpenedPackets(new Set());
        setShowResult(null);

        try {
          localStorage.setItem('current_round', nextRound.toString());
          localStorage.setItem('opened_packets', JSON.stringify([]));
        } catch (error) {
          console.error('ä¿å­˜å¤±è´¥:', error);
          alert('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•');
        }
      };

      const confirmReset = async () => {
        try {
          localStorage.setItem('opened_packets', JSON.stringify([]));
          setOpenedPackets(new Set());
          setShowResult(null);
          setShowResetModal(false);
          generateRedPackets();
        } catch (error) {
          console.error('é‡ç½®å¤±è´¥:', error);
          alert('é‡ç½®å¤±è´¥ï¼Œè¯·é‡è¯•');
        }
      };

      const confirmReconfig = async () => {
        try {
          localStorage.removeItem('lottery_config');
          localStorage.removeItem('current_round');
          localStorage.removeItem('opened_packets');

          setConfig(null);
          setCurrentRound(1);
          setOpenedPackets(new Set());
          setShowResult(null);
          setRedPackets([]);
          setShowReconfigModal(false);
          setCurrentPage('setup');
        } catch (error) {
          console.error('æ¸…ç©ºæ•°æ®å¤±è´¥:', error);
          alert('æ¸…ç©ºæ•°æ®å¤±è´¥ï¼Œè¯·é‡è¯•');
        }
      };

      if (currentPage === 'loading') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 flex items-center justify-center">
            <div className="text-white text-2xl">åŠ è½½ä¸­...</div>
          </div>
        );
      }

      if (currentPage === 'setup') {
        return React.createElement(SetupPage, { onSubmit: handleSetupSubmit, initialConfig: config });
      }

      const allOpened = openedPackets.size === config.totalPackets;
      const openedCount = openedPackets.size;

      return (
        <div className="min-h-screen bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 relative overflow-hidden">
          {/* è£…é¥°æ€§å…ƒç´  */}
          <div className="absolute inset-0 overflow-hidden pointer-events-none">
            <div className="absolute top-10 left-10 w-32 h-32 bg-yellow-300 rounded-full opacity-20 blur-3xl"></div>
            <div className="absolute bottom-20 right-20 w-40 h-40 bg-pink-300 rounded-full opacity-20 blur-3xl"></div>
          </div>

          {/* é¡¶éƒ¨ä¿¡æ¯æ  */}
          <div className="relative z-10 p-6">
            <div className="max-w-7xl mx-auto flex justify-between items-center">
              <div className="text-white">
                <h1 className="text-3xl font-bold mb-2">ğŸ§§ çº¢åŒ…æŠ½å¥–</h1>
                <p className="text-white/90">ç¬¬ {currentRound} / {config.totalRounds} è½®</p>
              </div>
              <div className="flex gap-3">
                <button
                  onClick={() => setShowResetModal(true)}
                  className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg backdrop-blur-sm transition flex items-center gap-2 active:scale-95"
                  title="é‡ç½®å½“å‰è½®æ¬¡è¿›åº¦"
                >
                  {/* RotateCcw */}
                  <svg className="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                  </svg>
                  é‡ç½®æœ¬è½®
                </button>
                <button
                  onClick={() => setShowReconfigModal(true)}
                  className="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg backdrop-blur-sm transition flex items-center gap-2 active:scale-95"
                  title="æ¸…ç©ºæ‰€æœ‰æ•°æ®å¹¶é‡æ–°é…ç½®"
                >
                  {/* Settings */}
                  <svg className="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                  </svg>
                  é‡æ–°è®¾ç½®
                </button>
              </div>
            </div>
          </div>

          {/* ç»Ÿè®¡ä¿¡æ¯ */}
          <div className="relative z-10 px-6 mb-6">
            <div className="max-w-7xl mx-auto bg-white/10 backdrop-blur-md rounded-2xl p-6">
              <div className="flex justify-between items-center text-white">
                <div>
                  <p className="text-sm opacity-80">å·²æŠ½å–</p>
                  <p className="text-3xl font-bold">{openedCount} / {config.totalPackets}</p>
                </div>
                <div className="flex gap-4">
                  {config.prizes.map((prize, index) => (
                    <div key={index} className="text-center">
                      <div
                        className="w-3 h-3 rounded-full mx-auto mb-1"
                        style={{ backgroundColor: prize.color }}
                      ></div>
                      <p className="text-xs opacity-80">{prize.name}</p>
                      <p className="text-sm font-semibold">{prize.count}ä¸ª</p>
                    </div>
                  ))}
                </div>
              </div>
            </div>
          </div>

          {/* çº¢åŒ…åŒºåŸŸ - ç½‘æ ¼å¸ƒå±€ */}
          <div className="relative z-10 px-6 pb-20 overflow-auto max-h-[calc(100vh-300px)]">
            <div className="max-w-7xl mx-auto">
              {redPackets.length === 0 ? (
                <div className="flex items-center justify-center min-h-[400px]">
                  <div className="text-white text-xl">æ­£åœ¨ç”Ÿæˆçº¢åŒ…...</div>
                </div>
              ) : (
                <div
                  className="grid gap-4 mx-auto"
                  style={{
                    gridTemplateColumns: `repeat(${Math.ceil(Math.sqrt(config.totalPackets * 1.2))}, minmax(0, 1fr))`,
                    maxWidth: `${Math.ceil(Math.sqrt(config.totalPackets * 1.2)) * 100}px`
                  }}
                >
                  {redPackets.map(packet => (
                    <div
                      key={packet.id}
                      onClick={() => handlePacketClick(packet)}
                      className={`cursor-pointer transition-all duration-500 flex items-center justify-center ${
                        openedPackets.has(packet.id) ? 'scale-0 opacity-0' : 'scale-100 opacity-100 hover:scale-110'
                      } ${animating ? 'pointer-events-none' : ''}`}
                    >
                      <div className="relative group">
                        <div className="w-20 h-24 bg-gradient-to-b from-red-500 to-red-600 rounded-lg shadow-xl flex items-center justify-center transform group-hover:rotate-6 transition">
                          {/* Gift */}
                          <svg className="w-8 h-8 text-yellow-300" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <path d="M3 8a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h18a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2"></path>
                            <path d="M3 12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-2H3z"></path>
                            <path d="m6 16 6-6 6 6"></path>
                          </svg>
                        </div>
                        <div className="absolute -top-2 -right-2 w-6 h-6 bg-yellow-400 rounded-full flex items-center justify-center text-xs font-bold text-red-600">
                          å¥–
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>

          {/* ä¸‹ä¸€è½®æŒ‰é’® */}
          {allOpened && currentRound < config.totalRounds && (
            <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-20">
              <button
                onClick={handleNextRound}
                className="bg-yellow-400 hover:bg-yellow-500 text-red-600 px-8 py-4 rounded-full font-bold text-lg shadow-2xl flex items-center gap-3 transition transform hover:scale-105"
              >
                {/* Play */}
                <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                å¼€å§‹ç¬¬ {currentRound + 1} è½®
              </button>
            </div>
          )}

          {/* å®Œæˆæç¤º */}
          {allOpened && currentRound === config.totalRounds && (
            <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-20">
              <div className="bg-white/95 backdrop-blur-md px-8 py-4 rounded-full shadow-2xl">
                <p className="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-pink-500">
                  ğŸ‰ æ‰€æœ‰è½®æ¬¡å·²å®Œæˆï¼
                </p>
              </div>
            </div>
          )}

          {/* é‡ç½®ç¡®è®¤å¼¹çª— */}
          {showResetModal && (
            React.createElement(ConfirmModal, {
              title: "é‡ç½®æœ¬è½®æŠ½å¥–",
              message: "ç¡®å®šè¦é‡ç½®å½“å‰è½®æ¬¡å—ï¼Ÿæ‰€æœ‰å·²æŠ½å–çš„çº¢åŒ…å°†è¢«é‡ç½®ï¼Œçº¢åŒ…å°†é‡æ–°éšæœºæ’åˆ—ã€‚",
              onConfirm: confirmReset,
              onCancel: () => setShowResetModal(false),
              confirmText: "ç¡®è®¤é‡ç½®",
              confirmColor: "bg-gradient-to-r from-orange-500 to-red-500"
            })
          )}

          {/* é‡æ–°è®¾ç½®å¼¹çª— */}
          {showReconfigModal && (
            React.createElement(ReconfigModal, {
              onEdit: () => {
                setShowReconfigModal(false);
                setCurrentPage('setup');
              },
              onClearAndNew: confirmReconfig,
              onCancel: () => setShowReconfigModal(false)
            })
          )}

          {/* ç»“æœå¼¹çª— */}
          {showResult !== null && (
            <div
              className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50"
              onClick={() => setShowResult(null)}
            >
              <div className="bg-white rounded-3xl p-10 text-center shadow-2xl max-w-md">
                {showResult ? (
                  <>
                    <div
                      className="w-32 h-32 mx-auto mb-6 rounded-full flex items-center justify-center"
                      style={{ backgroundColor: showResult.color }}
                    >
                      {/* Gift */}
                      <svg className="w-16 h-16 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                        <path d="M3 8a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h18a2 2 0 0 1 2 2v1a2 2 0 0 1-2 2"></path>
                        <path d="M3 12a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-2H3z"></path>
                        <path d="m6 16 6-6 6 6"></path>
                      </svg>
                    </div>
                    <h2 className="text-4xl font-bold mb-3 text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-pink-500">
                      æ­å–œä¸­å¥–ï¼
                    </h2>
                    <p className="text-2xl font-semibold text-gray-800">{showResult.name}</p>
                  </>
                ) : (
                  <>
                    <div className="w-32 h-32 mx-auto mb-6 bg-gray-200 rounded-full flex items-center justify-center">
                      <span className="text-6xl">ğŸ˜Š</span>
                    </div>
                    <h2 className="text-3xl font-bold mb-3 text-gray-700">è°¢è°¢å‚ä¸</h2>
                    <p className="text-lg text-gray-600">ç»§ç»­åŠ æ²¹ï¼</p>
                  </>
                )}
                <button
                  onClick={() => setShowResult(null)}
                  className="mt-6 bg-gradient-to-r from-red-500 to-pink-500 text-white px-8 py-3 rounded-full font-semibold hover:shadow-lg transition"
                >
                  ç»§ç»­æŠ½å¥–
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    // ç¡®è®¤å¯¹è¯æ¡†ç»„ä»¶
    const ConfirmModal = ({ title, message, onConfirm, onCancel, confirmText, confirmColor }) => {
      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
          <div className="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-2xl font-bold text-gray-800">{title}</h3>
              <button onClick={onCancel} className="text-gray-400 hover:text-gray-600">
                {/* X */}
                <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <path d="M18 6 6 18"></path>
                  <path d="m6 6 12 12"></path>
                </svg>
              </button>
            </div>
            <p className="text-gray-600 mb-8 leading-relaxed">{message}</p>
            <div className="flex gap-3">
              <button
                onClick={onCancel}
                className="flex-1 px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-semibold transition"
              >
                å–æ¶ˆ
              </button>
              <button
                onClick={onConfirm}
                className={`flex-1 px-6 py-3 ${confirmColor} text-white rounded-xl font-semibold hover:shadow-lg transition`}
              >
                {confirmText}
              </button>
            </div>
          </div>
        </div>
      );
    };

    // é‡æ–°è®¾ç½®é€‰é¡¹å¼¹çª—
    const ReconfigModal = ({ onEdit, onClearAndNew, onCancel }) => {
      return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50">
          <div className="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <div className="flex justify-between items-start mb-4">
              <h3 className="text-2xl font-bold text-gray-800">é‡æ–°è®¾ç½®</h3>
              <button onClick={onCancel} className="text-gray-400 hover:text-gray-600">
                {/* X */}
                <svg className="w-6 h-6" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                  <path d="M18 6 6 18"></path>
                  <path d="m6 6 12 12"></path>
                </svg>
              </button>
            </div>
            <p className="text-gray-600 mb-6">è¯·é€‰æ‹©é‡æ–°è®¾ç½®çš„æ–¹å¼ï¼š</p>

            <div className="space-y-3 mb-6">
              <button
                onClick={onEdit}
                className="w-full p-4 bg-blue-50 hover:bg-blue-100 border-2 border-blue-200 rounded-xl text-left transition group"
              >
                <div className="flex items-center justify-between">
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-1">ç¼–è¾‘å½“å‰é…ç½®</h4>
                    <p className="text-sm text-gray-600">ä¿ç•™å½“å‰è®¾ç½®ï¼Œè¿›å…¥ç¼–è¾‘æ¨¡å¼ä¿®æ”¹</p>
                  </div>
                  {/* Settings */}
                  <svg className="w-6 h-6 text-blue-500 group-hover:rotate-90 transition-transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                  </svg>
                </div>
              </button>

              <button
                onClick={onClearAndNew}
                className="w-full p-4 bg-red-50 hover:bg-red-100 border-2 border-red-200 rounded-xl text-left transition group"
              >
                <div className="flex items-center justify-between">
                  <div>
                    <h4 className="font-semibold text-gray-800 mb-1">æ¸…ç©ºå¹¶æ–°å»º</h4>
                    <p className="text-sm text-gray-600">æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Œä»å¤´å¼€å§‹é…ç½®</p>
                  </div>
                  {/* RotateCcw */}
                  <svg className="w-6 h-6 text-red-500 group-hover:rotate-180 transition-transform" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                  </svg>
                </div>
              </button>
            </div>

            <button
              onClick={onCancel}
              className="w-full px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl font-semibold transition"
            >
              å–æ¶ˆ
            </button>
          </div>
        </div>
      );
    };

    // è®¾ç½®é¡µé¢ç»„ä»¶
    const SetupPage = ({ onSubmit, initialConfig }) => {
      const [totalPackets, setTotalPackets] = useState(initialConfig?.totalPackets || 50);
      const [totalRounds, setTotalRounds] = useState(initialConfig?.totalRounds || 3);
      const [prizes, setPrizes] = useState(initialConfig?.prizes || [
        { name: 'ä¸€ç­‰å¥–', count: 1, color: '#FFD700' },
        { name: 'äºŒç­‰å¥–', count: 3, color: '#FF6B6B' },
        { name: 'ä¸‰ç­‰å¥–', count: 5, color: '#4ECDC4' }
      ]);

      const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#95E1D3', '#F38181', '#AA96DA', '#FCBAD3', '#A8D8EA'];

      const addPrize = () => {
        setPrizes([...prizes, { name: `å¥–é¡¹${prizes.length + 1}`, count: 1, color: colors[prizes.length % colors.length] }]);
      };

      const removePrize = (index) => {
        setPrizes(prizes.filter((_, i) => i !== index));
      };

      const updatePrize = (index, field, value) => {
        const newPrizes = [...prizes];
        newPrizes[index][field] = value;
        setPrizes(newPrizes);
      };

      const handleSubmit = () => {
        const totalPrizeCount = prizes.reduce((sum, p) => sum + parseInt(p.count || 0), 0);

        if (totalPrizeCount >= totalPackets) {
          alert('å¥–é¡¹æ€»æ•°å¿…é¡»å°äºçº¢åŒ…æ€»æ•°ï¼');
          return;
        }

        if (prizes.some(p => !p.name.trim() || !p.count || p.count < 1)) {
          alert('è¯·å®Œå–„æ‰€æœ‰å¥–é¡¹ä¿¡æ¯ï¼');
          return;
        }

        if (totalPackets < 10) {
          alert('çº¢åŒ…æ€»æ•°ä¸èƒ½å°‘äº10ä¸ªï¼');
          return;
        }

        if (totalRounds < 1) {
          alert('æ€»è½®æ•°ä¸èƒ½å°‘äº1è½®ï¼');
          return;
        }

        onSubmit({
          totalPackets: parseInt(totalPackets),
          totalRounds: parseInt(totalRounds),
          prizes: prizes.map(p => ({
            name: p.name.trim(),
            count: parseInt(p.count),
            color: p.color
          }))
        });
      };

      const totalPrizeCount = prizes.reduce((sum, p) => sum + parseInt(p.count || 0), 0);

      return (
        <div className="min-h-screen bg-gradient-to-br from-red-500 via-pink-500 to-purple-600 flex items-center justify-center p-6">
          <div className="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-8">
            <div className="text-center mb-8">
              <h1 className="text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-pink-500 mb-2">
                ğŸ§§ çº¢åŒ…æŠ½å¥–è®¾ç½®
              </h1>
              <p className="text-gray-600">é…ç½®æ‚¨çš„æŠ½å¥–æ´»åŠ¨</p>
            </div>

            <div className="space-y-6">
              {/* åŸºç¡€è®¾ç½® */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">æ¯ç»„çº¢åŒ…æ€»æ•°</label>
                  <input
                    type="number"
                    min="10"
                    value={totalPackets}
                    onChange={(e) => setTotalPackets(parseInt(e.target.value))}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-400 focus:outline-none transition"
                  />
                </div>
                <div>
                  <label className="block text-sm font-semibold text-gray-700 mb-2">æ€»è½®æ•°</label>
                  <input
                    type="number"
                    min="1"
                    value={totalRounds}
                    onChange={(e) => setTotalRounds(parseInt(e.target.value))}
                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-red-400 focus:outline-none transition"
                  />
                </div>
              </div>

              {/* å¥–é¡¹è®¾ç½® */}
              <div>
                <div className="flex justify-between items-center mb-3">
                  <label className="block text-sm font-semibold text-gray-700">å¥–é¡¹è®¾ç½®</label>
                  <button
                    onClick={addPrize}
                    className="text-sm bg-gradient-to-r from-red-500 to-pink-500 text-white px-4 py-2 rounded-lg hover:shadow-lg transition"
                  >
                    + æ·»åŠ å¥–é¡¹
                  </button>
                </div>

                <div className="space-y-3">
                  {prizes.map((prize, index) => (
                    <div key={index} className="flex gap-3 items-center bg-gray-50 p-4 rounded-xl">
                      <input
                        type="color"
                        value={prize.color}
                        onChange={(e) => updatePrize(index, 'color', e.target.value)}
                        className="w-12 h-12 rounded-lg cursor-pointer border-2 border-gray-300"
                      />
                      <input
                        type="text"
                        placeholder="å¥–é¡¹åç§°"
                        value={prize.name}
                        onChange={(e) => updatePrize(index, 'name', e.target.value)}
                        className="flex-1 px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-red-400 focus:outline-none"
                      />
                      <input
                        type="number"
                        min="1"
                        placeholder="æ•°é‡"
                        value={prize.count}
                        onChange={(e) => updatePrize(index, 'count', e.target.value)}
                        className="w-24 px-4 py-2 border-2 border-gray-200 rounded-lg focus:border-red-400 focus:outline-none"
                      />
                      {prizes.length > 1 && (
                        <button
                          onClick={() => removePrize(index)}
                          className="text-red-500 hover:text-red-700 font-bold px-3 py-2"
                        >
                          åˆ é™¤
                        </button>
                      )}
                    </div>
                  ))}
                </div>

                <div className="mt-3 text-sm text-gray-600 bg-blue-50 p-3 rounded-lg">
                  <p>å¥–é¡¹æ€»æ•°ï¼š{totalPrizeCount} ä¸ª / çº¢åŒ…æ€»æ•°ï¼š{totalPackets} ä¸ª</p>
                  <p>æœªä¸­å¥–çº¢åŒ…ï¼š{totalPackets - totalPrizeCount} ä¸ª</p>
                </div>
              </div>

              {/* æäº¤æŒ‰é’® */}
              <button
                onClick={handleSubmit}
                className="w-full bg-gradient-to-r from-red-500 to-pink-500 text-white py-4 rounded-xl font-bold text-lg hover:shadow-2xl transition transform hover:scale-105"
              >
                å¼€å§‹æŠ½å¥–
              </button>
            </div>
          </div>
        </div>
      );
    };

    // æ¸²æŸ“åº”ç”¨
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(LuckyDrawApp));
  </script>
</body>
</html>